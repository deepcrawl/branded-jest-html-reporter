<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="icon" sizes="16x16 32x32" href="https://www.deepcrawl.com/wp-content/uploads/2015/03/DC-1.png" />
    <title data-bind="text: projectName"></title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <script src="https://kit.fontawesome.com/10b9604242.js" crossorigin="anonymous"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.20/c3.css"
      integrity="sha512-GQSxWe9Cj4o4EduO7zO9HjULmD4olIjiQqZ7VJuwBxZlkWaUFGCxRkn39jYnD2xZBtEilm0m4WBG7YEmQuMs5Q=="
      crossorigin="anonymous"
    />

    <meta name="title" content="" />
    <meta
      name="description"
      content="A Simple API containing a curated set of metrics about the health of a webpage from the technical SEO point of view. It should act as a starting point for an engineer who likes to play and learn more about extracting insights from web pages for the purposes of SEO or testing."
    />

    <style>
      .container {
        margin-left: 0;
        margin-right: 0;
        padding-left: 20px;
      }
      .jumbotron {
        background-color: #24333e;
        color: white;
        border-radius: 0%;
        padding: 20px 0 0 0;
        margin-bottom: 10px;
      }

      .jumbotron h1 {
        font-weight: 100;
      }

      .jumbotron .brace {
        position: fixed;
        font-size: 52rem;
        top: -32rem;
        transform: rotate(20deg);
        opacity: 0.05;
        left: 5rem;
        pointer-events: none;
      }

      body {
        background: #f4f4f4;
        font-size: 16px;
      }

      .btn-primary {
        background: #7eac4a;
        border-color: #7eac4a;
      }

      .btn-primary:hover,
      .btn-primary:focus,
      .btn-primary.focus,
      .btn-primary.active,
      .btn-primary:active,
      .open > .dropdown-toggle.btn-primary {
        background: #679f2d !important;
        border-color: #679f2d !important;
        box-shadow: none;
      }

      .table-dark {
        color: #fff;
        background-color: #24343e;
      }

      .danger-text {
        color: #ca776c;
      }
      .success-text {
        color: #7eac4a;
      }
      ul {
        list-style-type: none;
        padding-left: 0;
      }
      ul ul {
        margin-left: 10px;
      }
      .list-group-item {
        border-color: transparent;
        margin-bottom: 1px;
      }
      a,
      a:hover {
        color: #4796bb;
      }
      .truncate {
        width: 60%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .nav {
        background-color: #24333e;
        position: fixed;
        height: 100%;
        width: 60%;
        left: 0;
        font-size: 16px;
        padding: 15px;
        overflow-y: scroll;
      }
      ul ul li a,
      ul ul li a:hover {
        color: rgba(229, 242, 255, 0.69);
      }
    </style>
  </head>

  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col-3">
          <ul data-bind="foreach: files" class="nav">
            <li class="truncate">
              <a data-bind="text: testFilePath, attr: { href: `#file-${$index()}` }"></a>

              <ul data-bind="foreach: suites">
                <li class="truncate">
                  <a
                    data-bind="text: name, attr: { href: `#suite-${$index()}-${$parentContext.$index()}`, tile: name }"
                  ></a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
        <div class="col-9" style="padding: 0; background: #f4f4f4">
          <div class="jumbotron">
            <span class="brace">{}</span>
            <div class="container">
              <h1>
                <a data-bind="attr: { href: repositoryUrl }"><i class="fa fa-github-alt" aria-hidden="true"></i> </a>
                <span data-bind="text: projectName"></span>
              </h1>
              <p class="lead" data-bind="text: projectDescription"></p>

              <table class="table table-dark">
                <tr>
                  <td>Total Tests</td>
                  <td>
                    <i
                      class="fa fa-exclamation-circle"
                      data-bind="css: { 'danger-text': results.numFailedTests > 0 }"
                    ></i>
                    Failed Tests
                  </td>
                  <td>
                    <i class="fa fa-check-circle-o success-text"></i>
                    Passed Tests
                  </td>
                </tr>
                <tr>
                  <td data-bind="text: results.numTotalTests"></td>
                  <td data-bind="text: results.numFailedTests, css: { 'danger-text': results.numFailedTests > 0 }"></td>
                  <td data-bind="text: results.numPassedTests" class="success-text"></td>
                </tr>
              </table>
            </div>
          </div>

          <div class="container">
            <div class="row justify-content-start">
              <div class="col-12">
                <div data-bind="foreach: files">
                  <h4 class="mb-1" data-bind="text: testFilePath, attr: { id: `file-${$index()}` }"></h4>

                  <div data-bind="foreach: suites">
                    <div>
                      <div>
                        <p
                          class="mb-1"
                          style="white-space: pre-wrap"
                          data-bind="text: name, attr: { id: `suite-${$index()}-${$parentContext.$index()}`}"
                        ></p>
                        <div class="list-group" data-bind="foreach: tests" style="margin-bottom: 30px">
                          <div
                            class="list-group-item"
                            data-bind="attr: { id: `test-${$index()}-${$parentContext.$index()}-${$parentContext.$parentContext.$index()}` }"
                          >
                            <div class="d-flex w-100 justify-content-between">
                              <p class="mb-1">
                                <i class="fa fa-flask" aria-hidden="true"></i>
                                <span data-bind="text: title"></span>
                              </p>
                              <small data-bind="text: status, css: { 'danger-text': status === 'failed' }"></small>
                            </div>
                            <code data-bind="foreach: failureDetails" class="danger-text">
                              Expected <span data-bind="text:error.matcherResult.expected"></span> but value was
                              <span data-bind="text:error.matcherResult.actual"></span>
                              (<span data-bind="text:error.matcherResult.name"></span>)
                            </code>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const templateData = <%-JSON.stringify(templateData)%>;
    </script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.1/knockout-latest.js"
      integrity="sha512-2AL/VEauKkZqQU9BHgnv48OhXcJPx9vdzxN1JrKDVc4FPU/MEE/BZ6d9l0mP7VmvLsjtYwqiYQpDskK9dG8KBA=="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/ramda/0.27.1/ramda.min.js"
      integrity="sha512-rZHvUXcc1zWKsxm7rJ8lVQuIr1oOmm7cShlvpV0gWf0RvbcJN6x96al/Rp2L2BI4a4ZkT2/YfVe/8YvB2UHzQw=="
      crossorigin="anonymous"
    ></script>
    <script>
      class ViewModel {
        constructor(data) {
          this.projectName = data.projectName;
          this.projectDescription = data.projectDescription;
          this.repositoryUrl = data.repositoryUrl;
          this.results = data.results;
          this.files = this.#getFiles();
          console.log(this.files);
        }

        #getFiles() {
          return this.results.testResults.map(s => {
            const paths = s.testFilePath.split("/");
            return {
              ...s,
              testFilePath: paths[paths.length - 1],
              suites: Object.entries(R.groupBy(i => i.ancestorTitles[0], s.testResults)).map(([name, tests]) => ({
                name,
                tests,
              })),
            };
          });
        }
      }

      ko.applyBindings(new ViewModel(templateData));
    </script>
  </body>
</html>
